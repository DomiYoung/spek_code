# 协同工作机制全景图

> 当前状态：精简后的单一知识库架构

---

## 一、协同流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              用户请求                                        │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  Layer 1: 编排层（workflow-orchestrator）                                    │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  Stage A: 硬门槛决策树                                                │   │
│  │  ├── 噪音过滤 → TodoWrite                                            │   │
│  │  ├── 强制升级条件 → Spec-Kit                                         │   │
│  │  └── 继续评估 → Stage B                                              │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  Stage B: 打分路由                                                    │   │
│  │  ├── score ≥ 7 → Spec-Kit                                            │   │
│  │  ├── score 3-6 → planning-with-files                                 │   │
│  │  └── score 1-2 → TodoWrite                                           │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
          ┌───────────────────────┼───────────────────────┐
          ▼                       ▼                       ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Spec-Kit      │     │ planning-with-  │     │   TodoWrite     │
│   工作流         │     │ files 工作流    │     │   直接执行       │
└────────┬────────┘     └────────┬────────┘     └────────┬────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  Layer 2: 专家路由层                                                         │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐ │
│  │  前端专家   │ │  后端专家   │ │  架构师    │ │  产品经理   │ │  领域专家   │ │
│  └────────────┘ └────────────┘ └────────────┘ └────────────┘ └────────────┘ │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  Layer 3: 能力层（Skills + MCP）                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  Skills（60+）                                                       │    │
│  │  ├── Spec-Kit 系列（9个）    ├── Patterns（18个）                    │    │
│  │  ├── Task Master（3个）      ├── Experts（7个）                      │    │
│  │  └── Tools（10+个）                                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  MCP Servers                                                         │    │
│  │  ├── Context7（文档）        ├── Magic（UI）                         │    │
│  │  ├── Sequential（推理）      ├── Playwright（测试）                  │    │
│  │  └── Tavily（搜索）                                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  Layer 4: 知识层（唯一知识库）                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  Skills SKILL.md                                                     │    │
│  │  按技术分类存储踩坑经验                                               │    │
│  │  ├── zustand-patterns/SKILL.md                                       │    │
│  │  ├── reactflow-patterns/SKILL.md                                     │    │
│  │  ├── react-query-patterns/SKILL.md                                   │    │
│  │  └── + Evolution Marker 追踪变更                                     │    │
│  │                                                                       │    │
│  │  触发：知识四问 → 2+ YES → 写入对应 SKILL.md                          │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、知识沉淀流程

### 知识四问评估

| 问题 | 说明 |
|------|------|
| 可复用？ | 其他项目/场景可能遇到 |
| 费力？ | 花了 >15 分钟调试 |
| 有帮助？ | 能避免重复踩坑 |
| 未文档化？ | 官方文档没有说明 |

**2+ YES → 写入对应 `skills/{tech}-patterns/SKILL.md` + Evolution Marker**

### Evolution Marker 格式

```markdown
<!-- Evolution: YYYY-MM-DD | source: {项目名} | trigger: {触发类型} | author: @{用户} -->
```

---

## 三、协同状态矩阵

```
┌─────────────────┬──────────────┬──────────────┬────────────────┐
│     组件         │  配置完成度   │  执行连通性   │  实际生效      │
├─────────────────┼──────────────┼──────────────┼────────────────┤
│ Core 框架       │  ✅ 100%     │  ⚠️ 依赖阅读  │  ⚠️ 部分生效   │
│ Skills          │  ✅ 60+ 个   │  ⚠️ 手动调用  │  ⚠️ 部分生效   │
│ MCP Servers     │  ✅ 已配置   │  ✅ 自动可用  │  ✅ 生效       │
│ Skills SKILL.md │  ✅ 唯一知识库│  ✅ 手动写入  │  ✅ 生效       │
└─────────────────┴──────────────┴──────────────┴────────────────┘
```

---

**Last Updated**: 2026-01-12 | **精简版**
