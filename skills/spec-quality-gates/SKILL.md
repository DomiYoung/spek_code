---
name: spec-quality-gates
description: |
  Spec-Kit 文档质量验证 - 规范完整性检查。
  Use when:
  - Spec-Kit 流程完成后验证
  - 检查 spec/plan/tasks 完整性
  - 文档质量审核
  触发词：Spec 验证、文档质量、规范检查
  Related Skills: speckit.analyze, speckit.specify, speckit.checklist
allowed-tools: Read, Grep
---

# Spec-Kit 文档质量验证

## 触发时机

- `/speckit.specify` 完成后
- `/speckit.plan` 完成后
- `/speckit.tasks` 完成后
- 用户请求验证 Spec 质量

## 验证清单

### spec.md 验证

| 维度 | 检查项 | 权重 |
|------|--------|-----|
| **问题定义** | 有明确的用户痛点描述 | 20% |
| **用户场景** | 包含主流程和边界情况 | 20% |
| **验收标准** | 每条标准可测试验证 | 25% |
| **非功能需求** | 性能、安全、兼容性 | 15% |
| **约束假设** | 技术栈、依赖、限制 | 10% |
| **风险识别** | 已知风险和缓解策略 | 10% |

#### 必须包含

```markdown
## 问题背景
[用户遇到什么问题？为什么需要解决？]

## 用户场景
### 主流程
1. 用户执行 A
2. 系统响应 B
3. 用户确认 C

### 边界情况
- 场景1：当 X 时...
- 场景2：当 Y 时...

## 验收标准
- [ ] AC1：[可测试的验收条件]
- [ ] AC2：[可测试的验收条件]

## 非功能需求
- 性能：[具体指标]
- 安全：[具体要求]

## 约束和假设
- 技术栈：React 18 + TypeScript
- 依赖：[列出依赖]
```

### plan.md 验证

| 维度 | 检查项 | 权重 |
|------|--------|-----|
| **架构设计** | 有组件/模块设计图 | 25% |
| **技术选型** | 选型有理由说明 | 20% |
| **接口定义** | API、Props 类型定义 | 20% |
| **状态设计** | 状态管理策略清晰 | 15% |
| **数据流** | 数据流向图 | 10% |
| **风险缓解** | 已知风险有应对 | 10% |

#### 必须包含

```markdown
## 架构设计
[架构图或组件图]

## 技术选型
| 技术 | 选择 | 理由 |
|------|------|------|
| 状态管理 | Zustand | 轻量、与 React 集成好 |

## 接口设计
### API
```typescript
// POST /api/workflow
interface CreateWorkflowRequest { ... }
interface CreateWorkflowResponse { ... }
```

### 组件 Props
```typescript
interface IterationNodeProps { ... }
```

## 状态设计
- UI 状态：Zustand
- 服务端数据：React Query
- 缓存：IndexedDB

## 数据流
[流程图或时序图]
```

### tasks.md 验证

| 维度 | 检查项 | 权重 |
|------|--------|-----|
| **粒度合理** | 每个任务 2-4 小时 | 25% |
| **依赖正确** | 没有循环依赖 | 20% |
| **可独立交付** | 每个任务可单独 PR | 20% |
| **完成定义** | 每个任务有 DoD | 20% |
| **优先级** | 有明确执行顺序 | 15% |

#### 必须包含

```markdown
## 任务列表

### Task 1: [任务名称]
- **优先级**: P0
- **预估**: 2h
- **依赖**: 无
- **DoD**:
  - [ ] 代码实现
  - [ ] 类型检查通过
  - [ ] 测试覆盖
- **PR**: ~50 行

### Task 2: [任务名称]
- **优先级**: P1
- **预估**: 3h
- **依赖**: Task 1
- **DoD**: ...
```

## 质量评分

```
评分 = Σ(维度得分 × 权重)

90-100: ✅ 优秀 - 可直接执行
80-89:  ✅ 良好 - 小问题可执行
70-79:  ⚠️ 及格 - 建议补充
60-69:  ❌ 不及格 - 需要修改
<60:    ❌ 严重不足 - 需要重写
```

## 验证输出

### ✅ 通过

```markdown
## Spec 质量验证: PASSED ✅

### spec.md: 92/100
- [✓] 问题定义清晰
- [✓] 用户场景完整
- [✓] 验收标准可测试
- [⚠️] 非功能需求可更详细

### plan.md: 88/100
- [✓] 架构设计完整
- [✓] 技术选型有理由
- [✓] 接口定义完整
- [⚠️] 建议添加时序图

### tasks.md: 95/100
- [✓] 任务粒度合理
- [✓] 依赖关系正确
- [✓] 每个任务可独立交付

**总体评分: 91/100 - 可以开始实现**
```

### ❌ 失败

```markdown
## Spec 质量验证: FAILED ❌

### spec.md: 58/100
- [✗] 缺少用户场景
- [✗] 验收标准不可测试
- [✗] 没有非功能需求

### 必须修复
1. 添加用户场景（主流程 + 边界情况）
2. 重写验收标准，使其可测试
3. 添加性能和安全需求

**修复后重新验证**
```

## 常见问题

### 问题 1：验收标准不可测试

```markdown
❌ 错误：
- [ ] 系统应该快速响应

✅ 正确：
- [ ] 页面加载时间 < 2 秒
- [ ] API 响应时间 < 500ms
```

### 问题 2：任务粒度过大

```markdown
❌ 错误：
- Task 1: 实现整个迭代节点功能 (预估 20h)

✅ 正确：
- Task 1: 创建 IterationNode 组件结构 (2h)
- Task 2: 实现子节点添加功能 (3h)
- Task 3: 实现子节点持久化 (3h)
- Task 4: 实现刷新后恢复 (2h)
```

### 问题 3：缺少技术选型理由

```markdown
❌ 错误：
- 使用 Zustand

✅ 正确：
- 使用 Zustand
  - 理由：比 Redux 轻量，API 简单
  - 对比：Context 不适合频繁更新的状态
  - 风险：团队需要学习新 API
```

## 🔗 与全局 Skills 协作

### 触发路径

```
Spec-Kit 流程完成
        ↓
本 Skill 自动触发验证
        ↓
输出质量评分和改进建议
```

### 协作关系

| Skill | 协作方式 |
|-------|----------|
| `workflow-router` | 权重 ≥ 7 时路由到 Spec-Kit |
| `code-quality-gates` | Spec 验收标准映射到代码检查 |
| `review-quality-gates` | 最终交付时验证 Spec 完成度 |

### 关联文件

- `.specify/specs/*/spec.md`
- `.specify/specs/*/plan.md`
- `.specify/specs/*/tasks.md`
