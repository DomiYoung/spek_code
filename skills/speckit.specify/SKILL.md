---
name: speckit.specify
description: |
  功能规范创建工具 - Spec-Kit 多轮对话式核心流程。
  Use when:
  - 创建新功能需要写规范文档
  - 任务权重 ≥7（复杂功能、架构变更）
  - Breaking Change、Schema 迁移、鉴权支付等高风险变更
  - 用户说"写 spec"、"功能设计"、"需求文档"
  触发词：spec、规范、需求、新功能、功能设计、PRD、.specify
  Related Skills: speckit.plan, speckit.tasks, speckit.clarify, brainstorm
globs:
  - ".specify/**/*"
  - "**/spec.md"
---

# Speckit.Specify（功能规范）

> **Skill 类型**：Dialogue-driven（对话驱动型）
> **核心理念**：渐进式规范生成，分段确认，门控进入下一阶段。

---

## Quick Start

```
需求理解(3-5轮追问) → 分段生成规范 → 逐段确认 → 门控进入 Clarify/Plan
```

---

## 核心流程（The Process）

### Phase 0: 需求理解（3-5 轮追问）

**在生成任何规范之前，先理解需求**：

**提问原则**：
- **一次一问** - 每条消息只包含一个问题
- **选择题优先** - 提供 2-3 个选项让用户选择
- **先给推荐** - 分析后给出推荐选项及理由

**追问焦点**：
```
第 1 轮：核心目标 - "这个功能要解决什么问题？"
第 2 轮：用户角色 - "主要用户是谁？有几种角色？"
第 3 轮：核心场景 - "用户最常用的操作路径是？"
第 4 轮：成功标准 - "怎样算做好了？有量化指标吗？"
第 5 轮：约束条件 - "有什么技术/时间/资源限制？"
```

**问题格式**：
```markdown
### 问题 [N]/5: [类别]

[问题描述]

**推荐**: 选项 [X] - [推荐理由]

| 选项 | 描述 |
|------|------|
| A | ... |
| B | ... |
| C | ... |

请选择或补充说明：
```

### Phase 1: 分支与文件初始化

当理解足够后（约 3-5 轮），初始化项目结构：

1. **生成简短名称** (2-4 词)：
   - 分析功能描述提取关键词
   - 使用 action-noun 格式（如 "add-user-auth"）
   - 保留技术术语（OAuth2, API, JWT 等）

2. **检查现有分支** 避免冲突：
   ```bash
   git fetch --all --prune
   ```

3. **运行初始化脚本**：
   ```bash
   .specify/scripts/bash/create-new-feature.sh --json --number N --short-name "name" "description"
   ```

4. **加载模板**：`.specify/templates/spec-template.md`

### Phase 2: 分段生成规范

**不要一次性生成完整 spec，而是分段呈现**：

| 段落 | 内容 | 字数 |
|------|------|------|
| 1. 概述 | 功能目标、用户价值 | 100-150 |
| 2. 用户场景 | 主要用例、用户流程 | 200-300 |
| 3. 功能需求 | 具体功能点、验收标准 | 200-300 |
| 4. 成功标准 | 量化指标、验证方法 | 100-150 |
| 5. 约束与假设 | 限制条件、前提假设 | 100-150 |

**每段后必须确认**：
```
以上 [段落名称] 描述准确吗？有需要调整的地方吗？
```

**用户确认后才继续下一段**。

### Phase 3: 整合与验证

所有段落确认后：

1. **整合到 spec.md** - 写入 SPEC_FILE
2. **质量验证** - 检查必填字段、一致性
3. **输出覆盖度卡片**：

```
╔════════════════════════════════════════════════════════╗
║  📋 Spec 生成完成                                       ║
╠════════════════════════════════════════════════════════╣
║  分支: [BRANCH_NAME]                                    ║
║  文件: [SPEC_FILE]                                      ║
║  ──────────────────────────────────────────────────── ║
║  ✅ 已完成: 概述、用户场景、功能需求、成功标准           ║
║  ⚠️ 待澄清: [N] 项 [NEEDS CLARIFICATION]                ║
╚════════════════════════════════════════════════════════╝
```

### Phase 4: 门控进入下一阶段

**必须询问**：

```markdown
---
Spec 已生成 ✓

**下一步选择**：
1. 📝 查看完整 Spec 文件
2. 🔍 进入 `/speckit.clarify` 澄清待定项
3. 🚀 直接进入 `/speckit.plan` 生成实现计划
4. 🔄 还需要调整某些部分

请选择 (1/2/3/4)：
```

**只有用户明确选择后才进入下一阶段**。

---

## 规范质量准则

### 内容准则

- 聚焦 **WHAT**（做什么）和 **WHY**（为什么）
- 避免 **HOW**（怎么实现）- 不涉及技术栈、API、代码结构
- 面向**业务干系人**，非开发者

### 成功标准准则

| ✅ 好的标准 | ❌ 差的标准 |
|------------|------------|
| "用户可在 3 分钟内完成结账" | "API 响应时间 < 200ms" |
| "系统支持 10,000 并发用户" | "数据库可处理 1000 TPS" |
| "95% 搜索在 1 秒内返回" | "React 组件渲染高效" |

### 待澄清标记

仅在以下情况标记 `[NEEDS CLARIFICATION: 具体问题]`：
- 选择会显著影响功能范围或用户体验
- 存在多种合理解释且影响不同
- 无法设定合理默认值

**限制**：最多 3 个待澄清标记

---

## 与其他 Skills 的关系

```
brainstorm (方案探索)
    ↓
speckit.specify (本 Skill - 生成规范)
    ↓
speckit.clarify (澄清待定项)
    ↓
speckit.plan (生成实现计划)
```

---

## Critical Guidelines

1. **先理解后生成** - 3-5 轮追问确认需求再动笔
2. **一次一问** - 不要用多个问题轰炸用户
3. **选择题优先** - 比开放式问题更容易回答
4. **分段呈现** - 每段 100-300 字，逐段确认
5. **门控下一步** - 用户明确选择后才进入下一阶段
6. **聚焦 WHAT/WHY** - 避免实现细节
